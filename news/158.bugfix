Made several functions less complex by splitting them.
[maurits]
